# https://taskfile.dev
version: "3"

tasks:
  download-omnibus:
    status:
      - test -f src/test-resources/omnibus/README.md
    cmds:
      - >
        git clone
        --depth 1
        https://github.com/Ragzouken/bitsy-archive.git
        src/test-resources/omnibus

  release:
    desc: build and publish release
    cmds:
      - test {{.CLI_ARGS}}
      - grep -F '"{{.CLI_ARGS}}"' Cargo.toml
      - cargo publish
      - git tag {{.CLI_ARGS}}
      - git push
      - git push --tags
      - gh release create --generate-notes {{.CLI_ARGS}}
  format:
    desc: "run code formatters"
    cmds:
      - cargo fmt
  test:
    desc: "run tests"
    cmds:
      - task: download-omnibus
      - cargo test
  lint:
    desc: "run linters"
    cmds:
      - cargo clippy
  all:
    cmds:
      - task: format
      - task: lint
      - task: test
  default:
    - task: all
